<div id="project-content" class="d-flex flex-column h-100">
    <div class="viewer-container">
        <div id="viewer" class="h-100">
        </div>
    </div>
</div>
<script>
    let lcViewerInterface = new LibCrowdsViewerInterface({ 
        id: 'viewer', 
        selectionEnabled: true,
        confirmBeforeLeaving: false,
        taskInputConfig: {
            title: 'Task',
            answerButtonText: 'Get Started',
            showProgress: false,
            showFavourites: false,
            showTutorial: false,
            showComments: false,
            showPreview: false
        }
    });
    
    let task = {
        id: 1,
        info: {
            objective: 'Identify each title',
            guidance: 'Draw a rectangle around the title of each play.',
            image_ark: 'ark:/81055/vdc_100022589157.0x000016',
            manifest_url: 'http://api.bl.uk/metadata/iiif/ark:/81055/vdc_100022589158.0x000002/manifest.json'
        }
    }
    
    lcViewerInterface.loadTask(task);

    // Highlight any task regions and show tutorial after image loads
    lcViewerInterface.viewer.addHandler('open', function() {
        var intro = introJs(),
            opts  = {
                doneLabel: "OK",
                exitOnOverlayClick: false,
                steps: [
                    {
                        element: "#toggle-selection",
                        intro: "Click this button to toggle area selection.",
                        position: "right"
                    },
                    {
                        element: "#selection",
                        intro: "Select an area of the image.",
                        position: "left"
                    },
                    {
                        element: "#done",
                        intro: "When all fields have been identified, click Done.",
                        position: "left"
                    }
                ]
            };
        
        var elt = $('<div></div>');
        elt.attr("id", "selection");
        elt.css({ 
            'border': '2px solid rgb(65, 144, 194)', 
            'background-color': 'rgba(65, 144, 194, 0.1)', 
            'opacity': '.6' 
        });
        lcViewerInterface.viewer.addOverlay({
            element: elt[0],
            location: new OpenSeadragon.Rect(0.09, 0.63, 0.80, 0.09)
        });
        
        intro.setOptions(opts);
        intro.start();
        
        intro.oncomplete(function() {
            window.location.pathname = 'project/{{ short_name }}/newtask';
        });
        
        $('#toggle-selection').on('click', function() {
            if(intro._currentStep === 3) {
                intro.goToStep(5);
            }
        });
    });
</script>